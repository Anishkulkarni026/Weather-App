<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Location</title>
</head>
<body>
  <h2>Your Location:</h2>
  <p id="user-location">Fetching location...</p>

  <script>
    // Start the location process
    function getUserLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError);
      } else {
        document.getElementById('user-location').innerText = "Geolocation is not supported by this browser.";
      }
    }

    // When location is successfully fetched
    function onLocationSuccess(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      fetchLocationDetails(lat, lon);
    }

    // Handle location error
    function onLocationError() {
      document.getElementById('user-location').innerText = "Unable to retrieve your location.";
    }

    // Use OpenWeatherMap Reverse Geocoding to get city/state/country
    function fetchLocationDetails(lat, lon) {
      const apiKey = '644ff1f179d6c750628bc09a296d4552';
      const url = `https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${apiKey}`;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data && data.length > 0) {
            const loc = data[0];
            const locationText = `${loc.name}, ${loc.state || ''}, ${loc.country}`;
            document.getElementById('user-location').innerText = locationText;
          } else {
            document.getElementById('user-location').innerText = "Location not found.";
          }
        })
        .catch(error => {
          console.error('Error fetching location details:', error);
          document.getElementById('user-location').innerText = "Error retrieving location data.";
        });
    }

    // Trigger on page load
    getUserLocation();
  </script>
</body>
</html>
